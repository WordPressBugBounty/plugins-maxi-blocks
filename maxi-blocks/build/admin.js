document.addEventListener("DOMContentLoaded",(function(){const e=window.location.href,t=new URL(e).searchParams.get("panel"),o=document.getElementById(t);o&&(o.checked=!0);const n=document.getElementById("maxi-dashboard_main-content_pro");n&&(n.style.display="none");const a=document.getElementById("maxi-dashboard_main-content_not-pro");if(a){a.style.display="block";const e=document.getElementById("maxi-dashboard_main-content_pro-not-pro");e&&(e.style.display="block")}const r=document.getElementsByClassName("maxi-dashboard_main-content_accordion-item-input"),i=document.getElementById("maxi-breakpoints");if(r&&i){const e=i?.value,t=JSON.parse(e);Array.from(r)?.forEach((e=>{const o=e.id.replace("maxi-breakpoint-","");e.addEventListener("input",(function(){const n=e.value;t[o]=parseInt(n),i.value=JSON.stringify(t)}))}))}const s=document.getElementById("maxi-versions"),l=document.getElementById("maxi-rollback-version");s?.addEventListener("change",(function(){const{value:e}=s;l.value=e}));const c=document.querySelectorAll(".maxi-dashboard_main-content_accordion-item-content-switcher__dropdown select");c&&Array.from(c).forEach((e=>{const t=document.querySelector(`input#${e.id}`);t.value=e.value,e.addEventListener("change",(function(){t.value=e.value}))}));const d=()=>{const e={lat:-25.344,lng:131.031},t=new google.maps.Map(document.getElementById("maxi-api-test"),{zoom:4,center:e});new google.maps.Marker({position:e,map:t})},m=(e,t,o,n,a="api-validation-loading",r="api-error")=>{const i=t();let s="";const{localization:l}=window;if("validating"===e)s=l.loading_status_message,n.classList.add(a),n.classList.remove(r);else if(n.classList.remove(a),""===i||"EmptyKeyError"===e)o.value="",n.classList.add(r),s=l.please_add_api_key;else switch(n.classList.add(r),e){case"InvalidKeyError":s=l.invalid_api_key;break;case"RefererNotAllowedError":s=l.referer_not_allowed;break;case"InvalidCharactersError":s=l.invalid_characters;break;case"ServerError":s=l.server_error;break;case!0:o.value=i,n.classList.remove(r)}n.innerHTML=s},u=e=>{e&&(e.addEventListener("focus",(()=>{e.type="text"})),e.addEventListener("blur",(()=>{e.type="password"})))},p=document.querySelector(".google-api-key-option-visible-input"),v=document.getElementById("google_api_key_option"),y=document.getElementById("maxi-api-test__validation-message");u(p);const h=document.getElementsByTagName("head")[0],g=()=>p.value,f=e=>{m(e,g,v,y)};p?.addEventListener("input",(function(){(()=>{const e=g();if((e=>!e.match(/^[a-zA-Z0-9_$.[\]]+$/))(e))return void f("InvalidCharactersError");const t=document.getElementById("maxi-test-google-map-script");t&&h.removeChild(t);const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?key=${e}&callback=initMap`,o.id="maxi-test-google-map-script",o.defer=!0,o.async=!0,h.appendChild(o),window.initMap=d,y.innerHTML="",y.classList.remove("api-error")})(),(()=>{const{console:e}=window;e&&(t=>{const o=e[t];e[t]=function(){arguments[0]&&(arguments[0].includes("InvalidKeyMapError")||arguments[0].includes("API multiple times")?f("InvalidKeyError"):arguments[0].includes("RefererNotAllowedMapError")?f("RefererNotAllowedError"):arguments[0].includes("API without a key")?f("EmptyKeyError"):f(!0)),o.apply&&o.apply(e,arguments)}})(["error"])})()}));const E=document.querySelector(".openai-api-key-option-visible-input"),_=document.getElementById("openai_api_key_option"),b=document.getElementById("maxi-api-test__validation-message");u(E);const w=()=>E.value,k=e=>{m(e,w,_,b)};let x=!1;const L=async e=>{if(x)return;x=!0;const t=document.getElementById("maxi_ai_model"),o=document.querySelector("input#maxi_ai_model");if(t&&o){if(!e)return t.innerHTML='<option value="">Please add your API key</option>',o.value="",void(x=!1);t.innerHTML='<option value="">Loading available models...</option>';try{const n=await(async e=>{try{const t=await fetch("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch models");const o=await t.json(),n=["audio","gpt-3.5-turbo-instruct","gpt-4o-mini-realtime-preview","gpt-4o-realtime-preview"],a=["o1","o3","gpt"];return o.data.filter((e=>{const t=e.id,o=n.some((e=>t.includes(e))),r=a.some((e=>t.includes(e)));return!o&&r})).map((e=>e.id)).sort()}catch(e){return console.error("Error fetching OpenAI models:",e),[]}})(e);if(t.innerHTML="",0===n.length){const e=document.createElement("option");return e.value="",e.textContent="No models available - check API key",t.appendChild(e),o.value="",void(x=!1)}n.forEach((e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)}));const a=window.maxiAiSettings?.defaultModel||"gpt-3.5-turbo";o.value=a,n.includes(a)?t.value=a:(t.value=n[0],o.value=n[0])}catch(e){console.error("Error updating model dropdown:",e),t.innerHTML='<option value="">Error loading models</option>',o.value=""}finally{x=!1}}else x=!1};if(E){const e=w();e&&L(e);const t=document.getElementById("maxi_ai_model");t&&t.addEventListener("change",(function(){const e=document.querySelector("input#maxi_ai_model");e&&(e.value=this.value)})),E.addEventListener("input",(()=>{(()=>{const e=w();""!==e?(k("validating"),Promise.all([fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({messages:[{role:"user",content:"Hello"}],model:"gpt-3.5-turbo",max_tokens:1})}),L(e)]).then((([e])=>{e.ok?k(!0):k("InvalidKeyError")})).catch((e=>{console.error(e),k("ServerError")}))):k("")})()}))}function I(e){e.style.height="auto",e.scrollHeight>300?(e.style.height="300px",e.style.overflowY="scroll"):(e.style.height=`${e.scrollHeight}px`,e.style.overflowY="hidden")}const A=document.querySelectorAll("textarea.maxi-dashboard_main-content_accordion-item-input");Array.from(A).forEach((e=>{I(e),e.addEventListener("input",(()=>{I(e)}))})),function(){const e=document.querySelector("#toplevel_page_maxi-blocks-dashboard");if(!e)return;const t=new URLSearchParams(window.location.search),o=t.get("tab"),n=t.get("page");e.querySelectorAll("li").forEach((e=>{e.classList.remove("current");const t=e.querySelector("a");t&&(t.classList.remove("current"),t.setAttribute("aria-current","false"))})),e.querySelectorAll("a").forEach((e=>{let t=!1;if("maxi-blocks-quick-start"===n&&e.href.includes("maxi-blocks-quick-start"))t=!0;else if(o){const n=e.href.match(/tab=([^&]*)/);n&&(t=n[1]===o)}else"maxi-blocks-dashboard"===n&&e.href.includes("maxi-blocks-dashboard")&&!e.href.includes("tab=")&&(t=!0);if(t){const t=e.closest("li");t&&(t.classList.add("current"),e.classList.add("current"),e.setAttribute("aria-current","page"))}}))}()}));