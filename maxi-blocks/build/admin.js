document.addEventListener("DOMContentLoaded",(function(){const e=window.location.href,t=new URL(e).searchParams.get("panel"),o=document.getElementById(t);o&&(o.checked=!0);const n=document.getElementById("maxi-dashboard_main-content_pro");n&&(n.style.display="none");const a=document.getElementById("maxi-dashboard_main-content_not-pro");a&&(a.style.display="block",document.getElementById("maxi-dashboard_main-content_pro-not-pro").style.display="block");const i=document.getElementsByClassName("maxi-dashboard_main-content_accordion-item-input"),r=document.getElementById("maxi-breakpoints");if(i&&r){const e=r?.value,t=JSON.parse(e);Array.from(i)?.forEach((e=>{const o=e.id.replace("maxi-breakpoint-","");e.addEventListener("input",(function(){const n=e.value;t[o]=parseInt(n),r.value=JSON.stringify(t)}))}))}const l=document.getElementById("maxi-versions"),s=document.getElementById("maxi-rollback-version");l?.addEventListener("change",(function(){const{value:e}=l;s.value=e}));const c=document.querySelectorAll(".maxi-dashboard_main-content_accordion-item-content-switcher__dropdown select");c&&Array.from(c).forEach((e=>{const t=document.querySelector(`input#${e.id}`);t.value=e.value,e.addEventListener("change",(function(){t.value=e.value}))}));const d=()=>{const e={lat:-25.344,lng:131.031},t=new google.maps.Map(document.getElementById("maxi-api-test"),{zoom:4,center:e});new google.maps.Marker({position:e,map:t})},m=(e,t,o,n,a="api-validation-loading",i="api-error")=>{const r=t();let l="";const{localization:s}=window;if("validating"===e)l=s.loading_status_message,n.classList.add(a),n.classList.remove(i);else if(n.classList.remove(a),""===r||"EmptyKeyError"===e)o.value="",n.classList.add(i),l=s.please_add_api_key;else switch(n.classList.add(i),e){case"InvalidKeyError":l=s.invalid_api_key;break;case"RefererNotAllowedError":l=s.referer_not_allowed;break;case"InvalidCharactersError":l=s.invalid_characters;break;case"ServerError":l=s.server_error;break;case!0:o.value=r,n.classList.remove(i)}n.innerHTML=l},p=e=>{e&&(e.addEventListener("focus",(()=>{e.type="text"})),e.addEventListener("blur",(()=>{e.type="password"})))},u=document.querySelector(".google-api-key-option-visible-input"),v=document.getElementById("google_api_key_option"),y=document.getElementById("maxi-api-test__validation-message");p(u);const g=document.getElementsByTagName("head")[0],h=()=>u.value,E=e=>{m(e,h,v,y)};u?.addEventListener("input",(function(){(()=>{const e=h();if((e=>!e.match(/^[a-zA-Z0-9_$.[\]]+$/))(e))return void E("InvalidCharactersError");const t=document.getElementById("maxi-test-google-map-script");t&&g.removeChild(t);const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?key=${e}&callback=initMap`,o.id="maxi-test-google-map-script",o.defer=!0,o.async=!0,g.appendChild(o),window.initMap=d,y.innerHTML="",y.classList.remove("api-error")})(),(()=>{const{console:e}=window;e&&(t=>{const o=e[t];e[t]=function(){arguments[0]&&(arguments[0].includes("InvalidKeyMapError")||arguments[0].includes("API multiple times")?E("InvalidKeyError"):arguments[0].includes("RefererNotAllowedMapError")?E("RefererNotAllowedError"):arguments[0].includes("API without a key")?E("EmptyKeyError"):E(!0)),o.apply&&o.apply(e,arguments)}})(["error"])})()}));const _=document.querySelector(".openai-api-key-option-visible-input"),f=document.getElementById("openai_api_key_option"),w=document.getElementById("maxi-api-test__validation-message");p(_);const x=()=>_.value,I=e=>{m(e,x,f,w)};let k=!1;const L=async e=>{if(k)return;k=!0;const t=document.getElementById("maxi_ai_model"),o=document.querySelector("input#maxi_ai_model");if(t&&o){if(!e)return t.innerHTML='<option value="">Please add your API key</option>',o.value="",void(k=!1);t.innerHTML='<option value="">Loading available models...</option>';try{const n=await(async e=>{try{const t=await fetch("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch models");const o=await t.json(),n=["audio","gpt-3.5-turbo-instruct","gpt-4o-mini-realtime-preview","gpt-4o-realtime-preview"],a=["o1","o3","gpt"];return o.data.filter((e=>{const t=e.id,o=n.some((e=>t.includes(e))),i=a.some((e=>t.includes(e)));return!o&&i})).map((e=>e.id)).sort()}catch(e){return console.error("Error fetching OpenAI models:",e),[]}})(e);if(t.innerHTML="",0===n.length){const e=document.createElement("option");return e.value="",e.textContent="No models available - check API key",t.appendChild(e),o.value="",void(k=!1)}n.forEach((e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)}));const a=window.maxiAiSettings?.defaultModel||"gpt-3.5-turbo";o.value=a,n.includes(a)?t.value=a:(t.value=n[0],o.value=n[0])}catch(e){console.error("Error updating model dropdown:",e),t.innerHTML='<option value="">Error loading models</option>',o.value=""}finally{k=!1}}else k=!1};if(_){const e=x();e&&L(e);const t=document.getElementById("maxi_ai_model");t&&t.addEventListener("change",(function(){const e=document.querySelector("input#maxi_ai_model");e&&(e.value=this.value)})),_.addEventListener("input",(()=>{(()=>{const e=x();""!==e?(I("validating"),Promise.all([fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({messages:[{role:"user",content:"Hello"}],model:"gpt-3.5-turbo",max_tokens:1})}),L(e)]).then((([e])=>{e.ok?I(!0):I("InvalidKeyError")})).catch((e=>{console.error(e),I("ServerError")}))):I("")})()}))}function b(e){e.style.height="auto",e.scrollHeight>300?(e.style.height="300px",e.style.overflowY="scroll"):(e.style.height=`${e.scrollHeight}px`,e.style.overflowY="hidden")}const B=document.querySelectorAll("textarea.maxi-dashboard_main-content_accordion-item-input");Array.from(B).forEach((e=>{b(e),e.addEventListener("input",(()=>{b(e)}))}))}));